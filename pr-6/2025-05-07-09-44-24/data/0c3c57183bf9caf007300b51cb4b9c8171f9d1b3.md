# Test info

- Name: Should fail
- Location: /home/runner/work/playwright-tests/playwright-tests/tests/example.spec.ts:20:1

# Error details

```
Error: expect(received).toBe(expected) // Object.is equality

Expected: false
Received: true
    at /home/runner/work/playwright-tests/playwright-tests/tests/example.spec.ts:21:16
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 |
   3 | test('has title', async ({ page }) => {
   4 |   await page.goto('https://playwright.dev/');
   5 |
   6 |   // Expect a title "to contain" a substring.
   7 |   await expect(page).toHaveTitle(/Playwright/);
   8 | });
   9 |
  10 | test('get started link', async ({ page }) => {
  11 |   await page.goto('https://playwright.dev/');
  12 |
  13 |   // Click the get started link.
  14 |   await page.getByRole('link', { name: 'Get started' }).click();
  15 |
  16 |   // Expects page to have a heading with the name of Installation.
  17 |   await expect(page.getByRole('heading', { name: 'Installation' })).toBeVisible();
  18 | });
  19 |
  20 | test('Should fail', async ({}) => {
> 21 |   expect(true).toBe(false);
     |                ^ Error: expect(received).toBe(expected) // Object.is equality
  22 | })
  23 |
```

# Local changes

```diff
diff --git a/.github/scripts/parse-test-results.mjs b/.github/scripts/parse-test-results.mjs
index f5b77d3..530496d 100644
--- a/.github/scripts/parse-test-results.mjs
+++ b/.github/scripts/parse-test-results.mjs
@@ -7,6 +7,7 @@ const workspaceDir = process.env.GITHUB_WORKSPACE || '.';
 // The path to the Playwright test results file is configured in the Playwright config file.
 const reportFilePath = join(workspaceDir, 'playwright-report', 'results.json');
 
+let total = 0;
 let passed = 0;
 let failed = 0;
 let flaky = 0;
@@ -22,10 +23,12 @@ try {
   const { stats } = report;
   if (!stats) throw new Error('No suites found in test results');
 
-  passed = stats.expected ?? 0;
   failed = stats.unexpected ?? 0;
   flaky = stats.flaky ?? 0;
   skipped = stats.skipped ?? 0;
+  total = failed + flaky + skipped;
+  total += stats.expected ?? 0;
+  passed = total - failed - flaky;
 
   info(`Parsing successful: Passed=${passed}, Failed=${failed}, Flaky=${flaky}, Skipped=${skipped}`);
 
@@ -34,6 +37,7 @@ try {
   setFailed(`Script failed: ${err.message}`);
 }
 
+setOutput('total', total);
 setOutput('passed', passed);
 setOutput('failed', failed);
 setOutput('flaky', flaky);
diff --git a/.github/scripts/pr-comment.mjs b/.github/scripts/pr-comment.mjs
index c9a4b9f..0eb9a84 100644
--- a/.github/scripts/pr-comment.mjs
+++ b/.github/scripts/pr-comment.mjs
@@ -13,18 +13,57 @@ try {
   const octokit = getOctokit(token);
   const { owner, repo, number } = context.issue
 
-  const commentBody = `Hey`;
+  const { TOTAL, PASSED, FAILED, FLAKY, SKIPPED, REPORT_FOLDER } = process.env;
 
-  await octokit.rest.issues.createComment({
+  const commentTitle = `# Playwright Test Results ${FAILED > 0 ? '❌' : '✅'}`;
+  const commentBody = `
+  ${commentTitle}
+  ## Summary
+  - **Total**: ${TOTAL}
+  - **Passed**: ${PASSED}
+  - **Failed**: ${FAILED}
+  - **Flaky**: ${FLAKY}
+  - **Skipped**: ${SKIPPED}
+  ## Details
+  [Report Link](${`https://${owner}.github.io/${repo}/${REPORT_FOLDER}`})
+
+  [ALL Reports Link](${`https://${owner}.github.io/${repo}}/`})
+  ## Additional Information
+  Last updated: ${new Date().toUTCString()}
+  `;
+
+   // Get all comments for this PR/issue
+   const { data: comments } = await octokit.rest.issues.listComments({
     owner,
     repo,
     issue_number: number,
-    body: commentBody,
-    headers: {
-      authorization: `token ${token}`,
-    },
   });
-  console.log('Comment created successfully');
+
+  // Look for an existing comment that starts with the same title
+  const existingComment = comments.find(comment => 
+    comment.body.trim().startsWith(commentTitle.trim())
+  )
+
+  if(existingComment) {
+    await octokit.rest.issues.updateComment({
+      owner,
+      repo,
+      comment_id: existingComment.id,
+      body: commentBody,
+    });
+    console.log('Comment updated successfully');
+  } else {
+    await octokit.rest.issues.createComment({
+      owner,
+      repo,
+      issue_number: number,
+      body: commentBody,
+      headers: {
+        authorization: `token ${token}`,
+      },
+    });
+    console.log('Comment created successfully');
+  }
 } catch (error) {
   console.error('Error creating comment:', error);
 }
diff --git a/.github/scripts/update-index-html.mjs b/.github/scripts/update-index-html.mjs
new file mode 100644
index 0000000..a3d2e96
--- /dev/null
+++ b/.github/scripts/update-index-html.mjs
@@ -0,0 +1,95 @@
+import * as core from '@actions/core';
+import { getOctokit, context } from '@actions/github';
+
+const intialeIndexContent = (newEntry) => `
+<!DOCTYPE html>
+<html>
+<head>
+  <title>Playwright Test Reports</title>
+  <style>
+    body { font-family: Arial, sans-serif; margin: 20px; }
+    h1 { color: #333; }
+    ul { list-style-type: none; padding: 0; }
+    li { margin: 10px 0; padding: 10px; border-bottom: 1px solid #eee; }
+    a { color: #0366d6; text-decoration: none; }
+    a:hover { text-decoration: underline; }
+  </style>
+</head>
+<body>
+  <h1>Playwright Test Reports</h1>
+  <ul>
+    ${newEntry}
+  </ul>
+</body>
+</html>
+`;
+
+try {
+  const token = process.env.GITHUB_TOKEN || core.getInput('github-token');
+  const reportFolder = process.env.REPORT_FOLDER;
+  const passed = process.env.PASSED || '0';
+  const failed = process.env.FAILED || '0';
+  const flaky = process.env.FLAKY || '0';
+  const skipped = process.env.SKIPPED || '0';
+
+  if (!token) {
+    throw new Error('No GitHub token provided.');
+  }
+
+  const octokit = getOctokit(token);
+  const { owner, repo } = context.repo;
+
+  core.info(`Updating index.html on gh-pages for ${owner}/${repo}`);
+
+  const reportTitle = `Test Report ${reportFolder}`;
+
+  const newEntry = `<li><a href="${reportFolder}/index.html">${reportTitle}</a> - Passed: ${passed}, Failed: ${failed}, Flaky: ${flaky}, Skipped: ${skipped}</li>`;
+    
+  let indexContent;
+  let sha;
+
+  try {
+    const { data: fileData } = await octokit.rest.repos.getContent({
+      owner,
+      repo,
+      path: 'index.html',
+      ref: 'gh-pages'
+    });
+    
+    sha = fileData.sha;
+    
+    // Decode content from base64
+    const content = Buffer.from(fileData.content, 'base64').toString();
+    
+    // Insert new entry after the <ul> tag
+    indexContent = content.replace('<ul>', `<ul>\n      ${newEntry}`);
+    
+    core.info('Existing index.html found, updating with new entry');
+  } catch(err) {
+    if(err.status === 404) {
+      indexContent = intialeIndexContent(indexContent);
+      core.info('No existing index.html found, creating a new one');
+    } else {
+      core.error('Error fetching index.html:', err);
+      throw err;
+    }
+  }
+
+  // Update or create index.html file
+  await octokit.rest.repos.createOrUpdateFileContents({
+    owner,
+    repo,
+    path: 'index.html',
+    message: `Update index.html with link to new test report: ${reportFolder}`,
+    content: Buffer.from(indexContent).toString('base64'),
+    branch: 'gh-pages',
+    ...(sha && { sha })
+  });
+  
+  core.info('Successfully updated index.html on gh-pages branch');
+
+
+} catch (error) {
+  core.setFailed(`Error updating index.html: ${error.message}`);
+  if (error.stack) core.debug(error.stack);
+}
diff --git a/.github/workflows/playwright.yml b/.github/workflows/playwright.yml
index fcb16a5..bdeff5f 100644
--- a/.github/workflows/playwright.yml
+++ b/.github/workflows/playwright.yml
@@ -31,11 +31,11 @@ jobs:
     name: Run Tests
     needs: wait-for-deployment-url
     runs-on: ubuntu-latest
-    outputs:
-      passed: ${{ steps.extract-test-results.outputs.passed }}
-      failed: ${{ steps.extract-test-results.outputs.failed }}
-      flaky: ${{ steps.extract-test-results.outputs.flaky }}
-      skipped: ${{ steps.extract-test-results.outputs.skipped }}
+    # outputs:
+    #   passed: ${{ steps.extract-test-results.outputs.passed }}
+    #   failed: ${{ steps.extract-test-results.outputs.failed }}
+    #   flaky: ${{ steps.extract-test-results.outputs.flaky }}
+    #   skipped: ${{ steps.extract-test-results.outputs.skipped }}
     env:
       BASE_URL: ${{ needs.wait-for-deployment-url.outputs.deployment_url }}
       GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
@@ -86,4 +86,21 @@ jobs:
           commit_message: "Deploy Playwright test report"
       - name: Comment on PR
         if: ${{ github.event_name == 'pull_request' }}
+        env:
+          REPORT_FOLDER: ${{ steps.generate-folder-name.outputs.folder_name }}
+          TOTAL: ${{ steps.extract-test-results.outputs.total }}
+          PASSED: ${{ steps.extract-test-results.outputs.passed }}
+          FAILED: ${{ steps.extract-test-results.outputs.failed }}
+          FLAKY: ${{ steps.extract-test-results.outputs.flaky }}
+          SKIPPED: ${{ steps.extract-test-results.outputs.skipped }}
         run: node .github/scripts/pr-comment.mjs
+      - name: Update index.html
+        if: ${{ !cancelled() }}
+        env:
+          REPORT_FOLDER: ${{ steps.generate-folder-name.outputs.folder_name }}
+          TOTAL: ${{ steps.extract-test-results.outputs.total }}
+          PASSED: ${{ steps.extract-test-results.outputs.passed }}
+          FAILED: ${{ steps.extract-test-results.outputs.failed }}
+          FLAKY: ${{ steps.extract-test-results.outputs.flaky }}
+          SKIPPED: ${{ steps.extract-test-results.outputs.skipped }}
+        run: node .github/scripts/update-index-html.mjs
diff --git a/tests/example.spec.ts b/tests/example.spec.ts
index 54a906a..f83842f 100644
--- a/tests/example.spec.ts
+++ b/tests/example.spec.ts
@@ -16,3 +16,7 @@ test('get started link', async ({ page }) => {
   // Expects page to have a heading with the name of Installation.
   await expect(page.getByRole('heading', { name: 'Installation' })).toBeVisible();
 });
+
+test('Should fail', async ({}) => {
+  expect(true).toBe(false);
+})
```